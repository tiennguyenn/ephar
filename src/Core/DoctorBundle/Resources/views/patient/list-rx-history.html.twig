{% extends '@Doctor/layout.html.twig' %}
{% block body %}

{% if app.user.isMPA %}
{% include '@Doctor/mpa/header.html.twig' %}
{% else %}
{% include '@Doctor/header.html.twig' %}
{% endif %}

<div class="page-container">

  {% if app.user.isMPA %}
  {% include '@Doctor/mpa/left-menu.html.twig' with { 'mainMenu': 'patient', 'subMenu': 'list-patient' } %}
  {% else %}
  {% include '@Doctor/left-menu.html.twig' with { 'mainMenu': 'patient', 'subMenu': 'list-patient' } %}
  {% endif %}

  <!-- BEGIN CONTENT -->
  <div class="page-content-wrapper">
    <!-- BEGIN CONTENT BODY -->
    <div class="page-content">
      <!-- BEGIN PAGE HEAD-->
      <div class="page-head">
        <!-- BEGIN PAGE TITLE -->
        <div class="page-title">
          <h1>RX History</h1>
        </div>
        <!-- END PAGE TITLE -->
      </div>
      <!-- END PAGE HEAD-->
      <!-- BEGIN PAGE BREADCRUMB -->
      <ul class="page-breadcrumb breadcrumb">
        <li> <a href="{{ path('doctor_dashboard') }}">Home</a><i class="fa fa-circle"></i></li>
        <li> <a href="{{ path('patient_index') }}">List patients</a><i class="fa fa-circle"></i></li>
        <li> <span class="active">RX History</span> </li>
      </ul>
      <!-- END PAGE BREADCRUMB -->
      <!-- BEGIN PAGE BASE CONTENT -->
      <div class="row">
        <div class="col-md-12">
          <!-- Begin: life time stats -->
          <div class="portlet light">
            <div class="portlet-body form">
              <div class="row patient-top-wrap mt-10">
                <div class="col-md-6">
                  <div class="patient-info">
                    <div class="info-item"><span>Patient Name:</span> <span class="bold">{{ patientInformation.name }} ({{ patientInformation.globalId }})</span></div>
                    <div class="info-group">
                      <div class="info-item"><span>Gender:</span> <span class="bold">{{ patientInformation.gender }}</span></div>
                      <div class="info-item"><span>Age:</span> <span class="bold">{{ patientInformation.age }}</span></div>
                      <div class="info-item"><span>Country:</span> <span class="bold">{{ patientInformation.address }}</span></div>
                    </div>
                    {% if patientInformation.allergies and patientInformation.allergies is not empty %}
                    <div class="patient-medication-allergies">
                      <span>Known Medication Allergies: {{ patientInformation.allergies }}</span>
                    </div>
					{% else %}
                    <div class="patient-medication-allergies">
                      <span>Known Medication Allergies: No known drug allergies</span>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="row col-md-12" style="clear: both; overflow: hidden; margin-bottom: 10px">
                  <a href="javascript:;" class="btn btn-ahalf-circle text-uppercase green-seagreen btn-icon-right btn-sm button-submit" id="btn-patient-note"> View or add patient notes </a>
                  <input type="hidden" value="{{ encodeHex(patientId) }}" id="current-patient-id" />
              </div>

              <br/>
              <div id="tableContainer" class="content-table dataTables_wrapper no-footer">
                {{ render(controller('DoctorBundle:Patient:ajaxListRXHistory', {'patientId': patientId}, {'patientId': patientId})) }}
              </div>
              <input type="hidden" id="sorting" value="">
            </div>
          </div>
        </div>
      </div>
      <!-- END PAGE BASE CONTENT -->
    </div>
    <!-- END CONTENT BODY -->
  </div>
  <!-- END CONTENT -->
</div>
<!-- END CONTAINER -->

<div id="modal-refill" class="modal fade modal-new" tabindex="-1" data-width="600" data-backdrop="static">
  <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-remove"></i></button>
      <h4 class="modal-title">Status</h4>
  </div>
  <div class="modal-body">
    <p>Date and Time: <span id="dateContainer"></span></p>
    <p class="statusMessage" style="display: none" data-type="1">Please notify my doctor to review and refill my prescription</p>
    <p class="statusMessage" style="display: none" data-type="2">I would like my doctor to contact me before I make a decision</p>
    <p class="statusMessage" style="display: none" data-type="0">I do not want my doctor review and refill my prescription</p>
  </div>
</div>


  <input type="hidden" id="load-patient-url" value="{{ path('patient_ajax_get_info') }}">

  <input type="hidden" id="export-patient-url" value="{{ path('patient_ajax_get_info_note_list',{patientId: patientId}) }}">

  <div id="modal-patient-note" class="modal fade modal-new" tabindex="-1" data-width="900">
    <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fa fa-remove"></i></button>
      <h4 class="modal-title">Patient Notes</h4>
    </div>
    <div class="modal-body">
      <div class="notes-patient-info patient-info bg-light-blue">

      </div>
      <div class="form mb-30">
        <div class="mb-5"><strong>Add a new note:</strong></div>
        <div class="form-group">
          <textarea rows="5" class="form-control" id="note-content" placeholder="Add notes about this patient"></textarea>
        </div>
        <div class="form-action text-right">
          <a href="javascript:;" id="btn-add-note" class="btn btn-ahalf-circle text-uppercase green-seagreen btn-sm btn-icon-right">Add Notes<i class="fa fa-plus"></i></a>
        </div>
      </div>

      <div class="mb-5"><strong>Previous Notes</strong></div>
      <div class="portlet box white portlet-scroller">
        <div class="portlet-body">
          <div class="scroller" style="height:280px" data-always-visible="1" data-rail-visible="1" data-rail-color="white" data-handle-color="green">
            <div class="table-scrollable table-scrollable-borderless">
              <div class="list-notes">

              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="clearfix">
        <div class="pull-left"><a href="javascript:;" class="btn btn-ahalf-circle text-uppercase green-seagreen btn-sm btn-icon-right" id="export-patient-note">Print<i class="fa fa-print"></i></a></div>
        <div class="pull-right"><a href="javascript:;" class="btn btn-ahalf-circle text-uppercase green-seagreen btn-sm btn-icon-right" data-dismiss="modal">Close Patient Notes<i class="fa fa-close"></i></a></div>
      </div>

    </div>
  </div>

{% endblock %}

{% block stylesheets %}
{% stylesheets 'bundles/admin/assets/global/plugins/datatables/datatables.min.css' 'bundles/admin/assets/global/plugins/datatables/plugins/bootstrap/datatables.bootstrap.css' 'bundles/admin/assets/global/plugins/bootstrap-modal/css/bootstrap-modal-bs3patch.css' 'bundles/admin/assets/global/plugins/bootstrap-modal/css/bootstrap-modal.css' 'bundles/admin/assets/global/plugins/icheck/skins/minimal/_all.css' filter='cssrewrite' %}
<link rel="stylesheet" href="{{ asset_url }}" />
{% endstylesheets %}
{% endblock %}

{% block javascripts %}
{% javascripts
'@AdminBundle/Resources/public/assets/global/plugins/bootstrap-modal/js/bootstrap-modalmanager.js'
'@AdminBundle/Resources/public/assets/global/plugins/bootstrap-modal/js/bootstrap-modal.js'
'@AdminBundle/Resources/public/assets/global/plugins/icheck/icheck.min.js'
'@AdminBundle/Resources/public/assets/layouts/global/scripts/quick-sidebar.min.js'
'@AdminBundle/Resources/public/assets/layouts/global/scripts/quick-nav.min.js'
'@PatientBundle/Resources/public/js/patient-common.js'
'@DoctorBundle/Resources/public/js/patient-rx-history.js' %}
<script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
{% endblock %}